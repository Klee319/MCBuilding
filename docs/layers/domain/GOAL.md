# Domain Layer - 目標と責務

## 概要

Domainレイヤは、クリーンアーキテクチャにおける最内層であり、Minecraft建築データ共有SNSのビジネスの核心となるルールとエンティティを定義する。

---

## 責務

### エンティティの定義

| Entity | 説明 |
|--------|------|
| Structure | 建築データ（ブロック配置、サイズ、メタデータ） |
| Post | 投稿（Structure + 公開設定 + ソーシャルメトリクス） |
| User | ユーザー（認証情報、プロフィール、アカウントレベル） |
| Comment | コメント（スレッド構造対応） |
| Like | いいね |
| Follow | フォロー関係 |
| Notification | 通知 |

### 値オブジェクトの定義

| Value Object | 説明 |
|-------------|------|
| Edition | Java版 / 統合版 |
| Version | MCバージョン（1.12〜最新） |
| FileFormat | schematic / litematic / mcstructure |
| Visibility | public / private / unlisted |
| AccountLevel | 認証レベル |
| Dimensions | 建築サイズ（x, y, z） |
| UnlistedUrl | 限定公開URL（ランダム文字列） |

### ドメインサービスの定義

| Service | 説明 |
|---------|------|
| VisibilityService | 公開設定に基づくアクセス可否判定 |
| VersionCompatibilityService | バージョン互換性判定 |

### ドメインイベント

| Event | 発火タイミング |
|-------|---------------|
| PostCreated | 投稿作成時 |
| PostLiked | いいね時 |
| CommentAdded | コメント追加時 |
| UserFollowed | フォロー時 |

---

## 許可される依存

**なし（最内層）**

- 外部ライブラリへの依存は原則禁止
- 他レイヤへの依存は禁止
- 言語標準ライブラリのみ使用可能

---

## 禁止事項

### 外部依存の禁止

- データベースアクセスコードを含めない
- HTTPクライアント等のI/O処理を含めない
- ファイルシステムへのアクセスを含めない
- 建築データのパース/変換処理を含めない（Infraの責務）

### フレームワーク依存の禁止

- Webフレームワーク固有のコードを含めない
- ORMのアノテーション・デコレータを使用しない
- DIコンテナ固有のコードを含めない

### インフラ層への依存禁止

- リポジトリの具象実装を参照しない
- 外部サービスの具象実装を参照しない
- StructureConverterの具象実装を参照しない

### その他の禁止事項

- 環境変数の直接参照
- ログ出力（ドメインイベント経由で行う）
- 副作用を持つ処理の直接実行

---

## 設計原則

1. **純粋性**: 副作用のない純粋関数を優先する
2. **不変性**: オブジェクトは可能な限り不変にする
3. **自己文書化**: ドメイン用語をそのままコードに反映する
4. **テスト容易性**: 外部依存がないため単体テストが容易

---

## 参照

- DTO定義: `docs/contracts/dtos.md`
- 要件定義書: `docs/requirements.md`
